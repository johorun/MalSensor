
import os
from collections import Counter
API = set()
with open('/home/zhj/data2/20230929/imp_API.txt', 'r',  encoding='utf8') as f:
	for line in f:
		API.add(line)
with open('/home/zhj/data2/20230929/APIlist.txt', 'w') as fd:
	for api in API:
		fd.write(api)

# API1 = set()
# API2 = set()
# API3 = set()
# API4 = set()
# with open('/home/zhj/data/20220412info/APIlist.txt', 'r') as f:
# 	for line in f:
# 		API1.add(line.strip())

# API6 = set()
# with open('/home/zhj/data2/MalwareBazaar/gexf/APIlist.txt', 'r') as f:
# 	for line in f:
# 		API6.add(line.strip())

# pefile_dir = '/home/zhj/data/20220412info/infoPEmalware18after/'
# pefile_list = os.listdir(pefile_dir)
# pefile_num = len(pefile_list)
# print(pefile_num)
# for file in pefile_list:
# 	with open(pefile_dir + file, mode = 'r') as f:
# 		for line in f:
# 			if 'Function Name:' in line:
# 				API2.add(line.split('Function Name:')[1].strip())
# pefile_dir = '/home/zhj/data/20220412info/infoPEmalware18before/'
# pefile_list = os.listdir(pefile_dir)
# pefile_num = len(pefile_list)
# print(pefile_num)
# for file in pefile_list:
# 	with open(pefile_dir + file, mode = 'r') as f:
# 		for line in f:
# 			if 'Function Name:' in line:
# 				API3.add(line.split('Function Name:')[1].strip())
# pefile_dir = '/home/zhj/data/20220412info/infoPEbenign/'
# pefile_list = os.listdir(pefile_dir)
# pefile_num = len(pefile_list)
# API5 = []
# print(pefile_num)
# for file in pefile_list:
# 	with open(pefile_dir + file, mode = 'r') as f:
# 		for line in f:
# 			if 'Function Name:' in line:
# 				API5.append(line.split('Function Name:')[1].strip())
# x = Counter(API5)
# for name in x.most_common(5000):
# 	API4.add(name[0])

# API = set()
# #API = API2 | API3 | API4 
# #API = API1 - (API1 - API)	#(API1 - API)是那些没被coderef调用的imp函数，例如call一个外壳在跳转到idata只有dataref

# # API = (API2 | API3) & API1 
# API = API6 | API4
# with open('/home/zhj/data2/MalwareBazaar/gexf/APIlist_mal.txt', 'w') as fd:
# 	for api in API:
# 		fd.write(api+'\n')

